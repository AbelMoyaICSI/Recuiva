<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Manrope%3Awght%40400%3B500%3B700%3B800&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<title>Recuiva - Sesión Práctica</title>
<link rel="icon" type="image/x-icon" href="../assets/img/Icon-Recuiva.ico"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="../assets/js/mockApi.js"></script>
<style type="text/tailwindcss">
      :root {
        --primary-color: #FF6600;
        --secondary-color: #004EAA;
        --accent-color: #A5CDED;
        --base-white: #FFFFFF;
        --base-gray: #F1F3F5;
        --text-primary: #181410;
        --text-secondary: #575757;
      }
      
      /* Estilo global para el logo Recuiva */
      .recuiva-logo {
        font-family: 'Manrope', sans-serif !important;
        font-weight: 800 !important;
        font-size: 1.5rem !important;
      }
      .hover-lift {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      }
      .menu-btn {
        cursor: pointer;
        transition: transform 0.3s ease;
      }
      .menu-btn:hover {
        transform: scale(1.1);
      }
      .mobile-menu {
        transform-origin: top;
        transition: transform 0.3s ease, opacity 0.3s ease;
        transform: scaleY(0);
        opacity: 0;
        pointer-events: none;
        height: 100vh;
        overflow-y: auto;
      }
      .mobile-menu.active {
        transform: scaleY(1);
        opacity: 1;
        pointer-events: auto;
      }
      #menu-btn.active .menu-icon {
        transform: rotate(180deg);
      }
      .profile-dropdown {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 1rem;
        box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        padding: 0.75rem 0;
        min-width: 14rem;
        z-index: 50;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        pointer-events: none;
      }
      .profile-dropdown.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
      }
      .profile-dropdown a, .profile-dropdown button {
        transition: all 0.2s ease;
      }
      .profile-dropdown a:hover, .profile-dropdown button:hover {
        transform: translateX(4px);
      }
      .notification-badge {
        position: absolute;
        top: -2px;
        right: -2px;
        background: var(--primary-color);
        color: white;
        border-radius: 9999px;
        font-size: 0.75rem;
        padding: 0.1rem 0.4rem;
        min-width: 1.2rem;
        text-align: center;
      }
      
      /* Modal de notificaciones mejorado - Estilo elegante */
      .notification-modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }
      .notification-modal.show {
        opacity: 1;
        visibility: visible;
      }
      .notification-modal-content {
        background: white;
        border-radius: 1.5rem;
        padding: 2rem;
        max-width: 26rem;
        margin: 1rem;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        transform: scale(0.8) translateY(30px);
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .notification-modal.show .notification-modal-content {
        transform: scale(1) translateY(0);
      }
      .notification-icon-container {
        background: linear-gradient(135deg, #FF6600, #FF8533);
        width: 4rem;
        height: 4rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        box-shadow: 0 8px 16px rgba(255, 102, 0, 0.3);
      }
      .notification-modal h3 {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.75rem;
        text-align: center;
      }
      .notification-modal p {
        font-size: 0.875rem;
        line-height: 1.6;
        color: #6b7280;
        text-align: center;
        margin-bottom: 2rem;
      }
      .modal-button {
        background: linear-gradient(135deg, #FF6600, #FF8533);
        color: white;
        border: none;
        border-radius: 0.75rem;
        padding: 0.75rem 2rem;
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
        width: 100%;
      }
      .modal-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 102, 0, 0.4);
      }
    </style>
</head>
<body class="bg-[var(--base-gray)]" style='font-family: Manrope, "Noto Sans", sans-serif;'>
<div class="relative flex size-full min-h-screen flex-col overflow-x-hidden">
<header class="bg-[var(--base-white)] shadow-md sticky top-0 z-50">
<div class="container mx-auto px-4 md:px-6 py-3 flex justify-between items-center">
  <div class="flex items-center gap-3">
    <a href="../index.html" class="flex items-center gap-2">
      <img src="../assets/img/Icon-Recuiva.png" alt="Logo Recuiva" class="h-10 w-10 object-contain md:h-12 md:w-12" style="max-width:48px; max-height:48px;"/>
      <span class="recuiva-logo text-[var(--text-primary)]">Recuiva</span>
    </a>
  </div>
  <nav class="hidden md:flex items-center gap-4">
    <a class="text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors px-2 py-1 rounded-lg" href="../index.html">Inicio</a>
    <a class="text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors px-2 py-1 rounded-lg" href="materiales.html">Materiales</a>
    <a class="text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors px-2 py-1 rounded-lg" href="../dashboard.html">Dashboard</a>
    <a class="text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors px-2 py-1 rounded-lg" href="repasos.html">Repasos</a>
    <a class="text-[var(--primary-color)] font-semibold px-2 py-1 rounded-lg" href="sesion-practica.html">Práctica</a>
  </nav>
  <div class="flex items-center gap-4">
    <!-- Notifications (solo desktop) -->
    <button onclick="showBackendModal('notifications', 'Notificaciones', 'Sistema de notificaciones en tiempo real para repasos, recordatorios y actualizaciones de progreso. Requiere conexión con servidor.')" class="hidden md:inline-block relative rounded-full p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700 focus:outline-none transition-all">
      <span class="material-symbols-outlined">notifications</span>
      <span class="notification-badge">3</span>
    </button>
    <!-- Profile Dropdown (solo desktop) -->
    <div class="hidden md:inline-block relative">
      <button id="profile-btn" class="flex items-center gap-2 rounded-full p-1 hover:bg-gray-100 focus:outline-none">
        <img alt="User profile picture" class="h-10 w-10 rounded-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCyGLORD72LxN41UVDA81HVOTMlzDwHkmzA2VA967ViruuCJi2GWPkaJZWBg6jKUb3EEInqAfLnwDb7X8JKy9NxA3xpKYnGqLnSPCFZTK7jPXl5-5b3KJmdHUujOgDYse9Ot1ytAsExi16vwZVLKXQFZSRJxHx9NMdIQ8PjucCFnApu7QGgJGzDiKcKBsZdsBH7V33SOTIlECl6u4f4QCkfbW-_QsCRV3EddCq478pupKgtJZQi74G8U1DdNn4IxfCTXnmZhbKfc8SR"/>
        <span class="material-symbols-outlined text-gray-500">expand_more</span>
      </button>
      <div id="profile-dropdown" class="profile-dropdown">
        <div class="px-4 py-3 border-b border-gray-100">
          <div class="flex items-center gap-3">
            <img class="h-10 w-10 rounded-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCyGLORD72LxN41UVDA81HVOTMlzDwHkmzA2VA967ViruuCJi2GWPkaJZWBg6jKUb3EEInqAfLnwDb7X8JKy9NxA3xpKYnGqLnSPCFZTK7jPXl5-5b3KJmdHUujOgDYse9Ot1ytAsExi16vwZVLKXQFZSRJxHx9NMdIQ8PjucCFnApu7QGgJGzDiKcKBsZdsBH7V33SOTIlECl6u4f4QCkfbW-_QsCRV3EddCq478pupKgtJZQi74G8U1DdNn4IxfCTXnmZhbKfc8SR" alt="Foto de perfil"/>
            <div>
              <div class="font-medium text-gray-900">Juan Pérez</div>
              <div class="text-sm text-gray-500">juan@ejemplo.com</div>
            </div>
          </div>
        </div>
        <a href="mi-perfil.html" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors">
          <span class="material-symbols-outlined mr-2">person</span>
          Mi Perfil
        </a>
        <hr class="my-1 border-gray-200">
        <button onclick="logout()" class="flex w-full items-center px-4 py-2 text-red-600 hover:bg-red-50">
          <span class="material-symbols-outlined mr-2">logout</span>
          Cerrar sesión
        </button>
      </div>
    </div>
    <!-- Botón menú móvil (solo móvil) -->
    <button class="menu-btn z-50 p-2 rounded-full hover:bg-gray-100 md:hidden" id="menu-btn">
      <span class="material-symbols-outlined text-3xl text-[var(--text-primary)] menu-icon">menu</span>
    </button>
  </div>
</div>
<!-- Mobile Menu -->
<div class="mobile-menu md:hidden fixed top-[73px] left-0 w-full bg-[var(--base-white)] z-40 shadow-lg" id="mobile-menu">
<div class="flex flex-col h-[calc(100vh-73px)] items-center justify-center gap-8">
  <!-- Perfil y configuración arriba de navegación -->
  <div class="flex flex-col items-center w-full mb-2 py-2">
    <div class="flex flex-col items-center w-full px-6 py-2 hover:bg-gray-100 rounded-xl cursor-pointer transition-all">
      <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuCyGLORD72LxN41UVDA81HVOTMlzDwHkmzA2VA967ViruuCJi2GWPkaJZWBg6jKUb3EEInqAfLnwDb7X8JKy9NxA3xpKYnGqLnSPCFZTK7jPXl5-5b3KJmdHUujOgDYse9Ot1ytAsExi16vwZVLKXQFZSRJxHx9NMdIQ8PjucCFnApu7QGgJGzDiKcKBsZdsBH7V33SOTIlECl6u4f4QCkfbW-_QsCRV3EddCq478pupKgtJZQi74G8U1DdNn4IxfCTXnmZhbKfc8SR" alt="Perfil" class="w-10 h-10 rounded-full border-2 border-blue-700 mx-auto object-cover" />
      <span class="text-base font-semibold text-gray-800 mt-2 text-center">Mi perfil</span>
    </div>
    <div class="flex flex-col items-center w-full px-6 py-2 hover:bg-gray-100 rounded-xl cursor-pointer transition-all">
      <span class="material-symbols-outlined mx-auto">settings</span>
    </div>
  </div>
  <hr class="w-2/3 border-gray-300 my-2" />
  <!-- Navegación principal -->
  <nav class="flex flex-col items-center gap-6 w-full">
    <a class="text-xl text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors" href="../index.html">Inicio</a>
    <a class="text-xl text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors" href="materiales.html">Materiales</a>
    <a class="text-xl text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors" href="../dashboard.html">Dashboard</a>
    <a class="text-xl text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors" href="repasos.html">Repasos</a>
    <a class="text-xl text-[var(--primary-color)] font-semibold" href="sesion-practica.html">Práctica</a>
  </nav>
  <hr class="w-2/3 border-gray-300 my-2" />
  <button onclick="logout()" class="flex items-center gap-2 text-base text-red-600 font-semibold">
    <span class="material-symbols-outlined">logout</span>
    Cerrar sesión
  </button>
</div>
</header>
<main class="flex-grow">
<div class="flex-grow w-full max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
<div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-full">
<div class="lg:col-span-3 bg-white rounded-xl shadow-sm border border-gray-200/80">
<div class="p-6">
<h2 class="text-xl font-bold text-gray-900 mb-4">Desafíos</h2>
<nav class="space-y-2">
<a class="flex items-center justify-between p-3 rounded-lg bg-[var(--primary-color)] text-white font-semibold" href="#">
<span>Desafío 1</span>
<span class="material-symbols-outlined text-lg">play_circle</span>
</a>
<a class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 text-gray-600" href="#">
<span>Desafío 2</span>
<span class="material-symbols-outlined text-lg text-gray-400">lock</span>
</a>
<a class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 text-gray-600" href="#">
<span>Desafío 3</span>
<span class="material-symbols-outlined text-lg text-gray-400">lock</span>
</a>
<a class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 text-gray-600" href="#">
<span>Desafío 4</span>
<span class="material-symbols-outlined text-lg text-gray-400">lock</span>
</a>
<a class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 text-gray-600" href="#">
<span>Desafío 5</span>
<span class="material-symbols-outlined text-lg text-gray-400">lock</span>
</a>
<a class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 text-gray-600" href="#">
<span>Desafío 6</span>
<span class="material-symbols-outlined text-lg text-gray-400">lock</span>
</a>
<a class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 text-gray-600" href="#">
<span>Desafío 7</span>
<span class="material-symbols-outlined text-lg text-gray-400">lock</span>
</a>
<a class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 text-gray-600" href="#">
<span>Desafío 8</span>
<span class="material-symbols-outlined text-lg text-gray-400">lock</span>
</a>
<a class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 text-gray-600" href="#">
<span>Desafío 9</span>
<span class="material-symbols-outlined text-lg text-gray-400">lock</span>
</a>
<a class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 text-gray-600" href="#">
<span>Desafío 10</span>
<span class="material-symbols-outlined text-lg text-gray-400">lock</span>
</a>
</nav>
</div>
</div>
<div class="lg:col-span-6 bg-white rounded-xl shadow-sm border border-gray-200/80 p-6 md:p-8 space-y-8">
<div>
<h3 class="text-2xl font-bold text-gray-900 mb-6">¿Cuál es la capital de Francia?</h3>
<div class="space-y-6">
<textarea class="form-textarea w-full resize-none rounded-lg border-gray-300 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-25 transition duration-200 p-4" placeholder="Escribe tu respuesta aquí..." rows="4"></textarea>
<div class="flex items-center justify-between gap-4">
<div class="flex gap-3">
<button class="flex items-center gap-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold px-4 py-2 text-sm transition-colors duration-200">
<span class="material-symbols-outlined text-base">lightbulb</span>
<span>Pista 1</span>
</button>
<button class="flex items-center gap-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold px-4 py-2 text-sm transition-colors duration-200">
<span class="material-symbols-outlined text-base">lightbulb</span>
<span>Pista 2</span>
</button>
</div>
<button class="flex items-center gap-2 rounded-lg bg-gray-200 text-gray-400 font-semibold px-4 py-2 text-sm cursor-not-allowed" disabled="">
<span class="material-symbols-outlined text-base">visibility</span>
<span>Mostrar Solución</span>
</button>
</div>
</div>
</div>
<div>
<h2 class="text-xl font-bold text-gray-900 mb-4">Autoevaluación</h2>
<div class="flex flex-wrap gap-3">
<label class="relative flex items-center justify-center rounded-lg border-2 border-transparent px-5 py-2.5 text-sm font-medium transition-all duration-200 cursor-pointer bg-gray-100 has-[:checked]:bg-green-100 has-[:checked]:text-green-800 has-[:checked]:border-green-400">
<input class="absolute opacity-0" name="difficulty" type="radio"/>
                  Fácil
                </label>
<label class="relative flex items-center justify-center rounded-lg border-2 border-transparent px-5 py-2.5 text-sm font-medium transition-all duration-200 cursor-pointer bg-gray-100 has-[:checked]:bg-yellow-100 has-[:checked]:text-yellow-800 has-[:checked]:border-yellow-400">
<input class="absolute opacity-0" name="difficulty" type="radio"/>
                  Medio
                </label>
<label class="relative flex items-center justify-center rounded-lg border-2 border-transparent px-5 py-2.5 text-sm font-medium transition-all duration-200 cursor-pointer bg-gray-100 has-[:checked]:bg-red-100 has-[:checked]:text-red-800 has-[:checked]:border-red-400">
<input class="absolute opacity-0" name="difficulty" type="radio"/>
                  Difícil
                </label>
</div>
</div>
</div>
<div class="lg:col-span-3 bg-white rounded-xl shadow-sm border border-gray-200/80">
<div class="p-6">
<h2 class="text-xl font-bold text-gray-900 mb-4">Métricas en Vivo</h2>
<div class="space-y-4">
<div class="flex flex-col gap-2 rounded-lg p-4 bg-gray-50 border border-gray-200/80">
<p class="text-sm font-medium text-gray-600">% Aciertos</p>
<p class="text-3xl font-bold text-gray-900">80%</p>
</div>
<div class="flex flex-col gap-2 rounded-lg p-4 bg-gray-50 border border-gray-200/80">
<p class="text-sm font-medium text-gray-600">Tiempo</p>
<p class="text-3xl font-bold text-gray-900">00:30</p>
</div>
<div class="flex flex-col gap-2 rounded-lg p-4 bg-gray-50 border border-gray-200/80">
<p class="text-sm font-medium text-gray-600">Retención</p>
<p class="text-3xl font-bold text-gray-900">90%</p>
</div>
</div>
</div>
</div>
</div>
</div>
</main>
<footer class="bg-[var(--secondary-color)] text-[var(--base-gray)] py-12 px-6 mt-16">
<div class="container mx-auto text-center">
<div class="flex justify-center items-center gap-2 mb-6">
<img src="../assets/img/Icon-Recuiva.png" alt="Logo Recuiva" class="h-10 w-10 object-contain md:h-12 md:w-12" style="max-width:48px; max-height:48px;"/>
<span class="text-2xl font-black">Recuiva</span>
</div>
<div class="flex flex-wrap items-center justify-center gap-x-6 gap-y-2 mb-6">
<a class="hover:text-[var(--primary-color)] transition-colors" href="../institucional/active-recall.html">Active Recall</a>
<a class="hover:text-[var(--primary-color)] transition-colors" href="../institucional/validacion-semantica.html">Validación Semántica</a>
<a class="hover:text-[var(--primary-color)] transition-colors" href="../institucional/diferencias.html">Diferencias</a>
<a class="hover:text-[var(--primary-color)] transition-colors" href="#">Contacto</a>
<a class="hover:text-[var(--primary-color)] transition-colors" href="#">Términos</a>
<a class="hover:text-[var(--primary-color)] transition-colors" href="#">Privacidad</a>
</div>
<p class="text-sm">© 2025 Recuiva. Todos los derechos reservados.</p>
</div>
</footer>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // === FUNCIONES MODALES BACKEND MEJORADAS ===
  window.showBackendModal = function(icon, title, description) {
    showAdvancedModal(icon, title, description);
  };
  
  // Modal avanzado con mejor UX
  window.showAdvancedModal = function(icon, title, description) {
    // Crear modal si no existe
    let modal = document.getElementById('advanced-modal');
    if (!modal) {
      modal = document.createElement('div');
      modal.id = 'advanced-modal';
      modal.className = 'notification-modal';
      modal.innerHTML = `
        <div class="notification-modal-content">
          <div class="notification-icon-container">
            <span class="material-symbols-outlined text-2xl text-white" id="modal-icon">notifications</span>
          </div>
          <h3 id="modal-title">🔔 Notificaciones</h3>
          <p id="modal-description">Sistema de notificaciones en tiempo real para repasos, recordatorios y actualizaciones de progreso. Requiere conexión con servidor. Por ahora puedes explorar la funcionalidad simulada. En la versión completa con backend, esto funcionará en tiempo real.</p>
          <button onclick="closeAdvancedModal()" class="modal-button">
            Aceptar
          </button>
        </div>
      `;
      document.body.appendChild(modal);
      
      // Cerrar con escape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('show')) {
          closeAdvancedModal();
        }
      });
      
      // Cerrar clickeando fuera
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          closeAdvancedModal();
        }
      });
    }
    
    // Actualizar contenido
    const iconMap = {
      'notifications': '🔔',
      'settings': '⚙️',
      'dashboard': '📊',
      'analytics': '📈'
    };
    
    document.getElementById('modal-icon').textContent = icon;
    document.getElementById('modal-title').textContent = `${iconMap[icon] || '📋'} ${title}`;
    document.getElementById('modal-description').textContent = description;
    
    // Mostrar modal con animación
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
  };
  
  window.closeAdvancedModal = function() {
    const modal = document.getElementById('advanced-modal');
    if (modal) {
      modal.classList.remove('show');
      document.body.style.overflow = '';
    }
  };
  
  // === FUNCIONES NAVEGACIÓN ===
  window.logout = function() {
    if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
      localStorage.removeItem('recuiva_user');
      window.location.href = '../auth/iniciar-sesion.html';
    }
  };

  // Menú móvil animación landing-page
  const menuBtn = document.getElementById('menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = menuBtn.querySelector('.material-symbols-outlined');
  let isMenuOpen = false;

  function toggleMenu() {
    isMenuOpen = !isMenuOpen;
    mobileMenu.classList.toggle('active');
    document.body.classList.toggle('overflow-hidden');
    menuIcon.style.transition = 'transform 0.3s ease, opacity 0.15s ease';
    if (isMenuOpen) {
      menuIcon.style.transform = 'rotate(90deg)';
      menuIcon.style.opacity = '0';
      setTimeout(() => {
        menuIcon.textContent = 'close';
        menuIcon.style.transform = 'rotate(0deg)';
        menuIcon.style.opacity = '1';
      }, 150);
    } else {
      menuIcon.style.transform = 'rotate(90deg)';
      menuIcon.style.opacity = '0';
      setTimeout(() => {
        menuIcon.textContent = 'menu';
        menuIcon.style.transform = 'rotate(0deg)';
        menuIcon.style.opacity = '1';
      }, 150);
    }
  }

  menuBtn.addEventListener('click', toggleMenu);
  // Cerrar menú cuando se hace clic en un enlace
  const menuLinks = mobileMenu.querySelectorAll('a');
  menuLinks.forEach(link => {
    link.addEventListener('click', () => {
      if (isMenuOpen) {
        toggleMenu();
      }
    });
  });

  // Menú de perfil
  const profileBtn = document.getElementById('profile-btn');
  const profileDropdown = document.getElementById('profile-dropdown');
  function toggleProfileMenu(e) {
    e.stopPropagation();
    profileDropdown.classList.toggle('active');
  }
  if (profileBtn && profileDropdown) {
    profileBtn.addEventListener('click', toggleProfileMenu);
    document.addEventListener('click', (e) => {
      if (!profileDropdown.contains(e.target) && !profileBtn.contains(e.target)) {
        profileDropdown.classList.remove('active');
      }
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        profileDropdown.classList.remove('active');
      }
    });
  }

  // === INTEGRACIÓN MOCKAPI PARA SESIÓN DE PRÁCTICA ===
  
  // Verificar autenticación
  if (!mockAPI.isAuthenticated()) {
    window.location.href = '../auth/iniciar-sesion.html';
    return;
  }

  // Variables de sesión
  let currentQuestions = [];
  let currentIndex = 0;
  let sessionResults = [];
  let sessionStartTime = Date.now();

  // Inicializar sesión de práctica
  initializePracticeSession();

  async function initializePracticeSession() {
    // Cargar set actual o usar datos por defecto
    const currentSet = JSON.parse(localStorage.getItem('recuiva_current_study_set') || 'null');
    
    if (currentSet && currentSet.questions) {
      currentQuestions = currentSet.questions;
    } else {
      // Usar preguntas por defecto
      currentQuestions = [
        {
          id: 'q1',
          question: '¿Qué es la pulpa dental?',
          answer: 'Tejido conectivo ubicado en la cavidad pulpar del diente, contiene nervios y vasos sanguíneos.',
          difficulty: 2
        },
        {
          id: 'q2',
          question: '¿Cuáles son los síntomas de pulpitis?',
          answer: 'Dolor intenso, sensibilidad térmica, dolor nocturno espontáneo.',
          difficulty: 3
        },
        {
          id: 'q3',
          question: '¿Qué es el tratamiento endodóntico?',
          answer: 'Procedimiento para remover la pulpa infectada y sellar el conducto.',
          difficulty: 1
        }
      ];
    }

    // Limitar a 5 preguntas por sesión
    currentQuestions = currentQuestions.slice(0, 5);
    
    // Iniciar primera pregunta
    showCurrentQuestion();
  }

  function showCurrentQuestion() {
    if (currentIndex >= currentQuestions.length) {
      finishSession();
      return;
    }

    const question = currentQuestions[currentIndex];
    
    // Actualizar UI (si existen los elementos)
    const questionText = document.getElementById('question-text') || document.querySelector('h2');
    const answerText = document.getElementById('answer-text') || document.querySelector('.answer-content');
    const progressText = document.getElementById('progress-text') || document.querySelector('.progress-info');

    if (questionText) questionText.textContent = question.question;
    if (answerText) answerText.textContent = question.answer;
    if (progressText) progressText.textContent = `Pregunta ${currentIndex + 1} de ${currentQuestions.length}`;

    // Mostrar botón de revelar
    showRevealButton();
  }

  function showRevealButton() {
    // Crear botón de revelar si no existe
    let revealBtn = document.getElementById('reveal-btn');
    if (!revealBtn) {
      revealBtn = document.createElement('button');
      revealBtn.id = 'reveal-btn';
      revealBtn.className = 'px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-medium';
      revealBtn.textContent = '👁️ Mostrar Respuesta';
      
      const container = document.querySelector('main') || document.body;
      container.appendChild(revealBtn);
    }

    revealBtn.style.display = 'block';
    revealBtn.onclick = showAnswer;
  }

  function showAnswer() {
    // Ocultar botón revelar
    const revealBtn = document.getElementById('reveal-btn');
    if (revealBtn) revealBtn.style.display = 'none';

    // Mostrar respuesta y botones de puntuación
    showScoreButtons();
  }

  function showScoreButtons() {
    // Crear botones de puntuación si no existen
    let scoreContainer = document.getElementById('score-container');
    if (!scoreContainer) {
      scoreContainer = document.createElement('div');
      scoreContainer.id = 'score-container';
      scoreContainer.className = 'mt-6 space-y-3';
      scoreContainer.innerHTML = `
        <h3 class="text-lg font-semibold text-center mb-4">¿Cómo respondiste?</h3>
        <div class="grid grid-cols-2 gap-3">
          <button onclick="scoreAnswer(1)" class="p-3 bg-red-500 text-white rounded-lg hover:bg-red-600 font-medium">
            😔 Mala (1)
          </button>
          <button onclick="scoreAnswer(2)" class="p-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 font-medium">
            😐 Regular (2)
          </button>
          <button onclick="scoreAnswer(3)" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-medium">
            😊 Buena (3)
          </button>
          <button onclick="scoreAnswer(4)" class="p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-medium">
            🎉 Excelente (4)
          </button>
        </div>
      `;
      
      const container = document.querySelector('main') || document.body;
      container.appendChild(scoreContainer);
    }

    scoreContainer.style.display = 'block';
  }

  // Función global para puntuar respuesta
  window.scoreAnswer = async function(score) {
    const question = currentQuestions[currentIndex];
    
    // Registrar resultado
    const result = {
      questionId: question.id,
      score: score,
      currentInterval: 1, // Mock interval
      timestamp: new Date().toISOString()
    };
    
    sessionResults.push(result);
    
    // Simular guardado
    await mockAPI.apiSaveReviewResultMock(result);
    
    // Mostrar feedback
    const intervalText = getIntervalText(score);
    alert(`Puntuación: ${score}/4\nPróximo repaso: ${intervalText}`);
    
    // Siguiente pregunta
    currentIndex++;
    showCurrentQuestion();
  };

  function getIntervalText(score) {
    switch(score) {
      case 1: return '1 día (resetear)';
      case 2: return 'Reducido 50%';
      case 3: return 'Mantener intervalo';
      case 4: return 'Aumentar 30%';
      default: return 'Sin cambios';
    }
  }

  function finishSession() {
    const avgScore = sessionResults.reduce((sum, r) => sum + r.score, 0) / sessionResults.length;
    
    alert(`¡Sesión completada!\n\nPreguntas: ${sessionResults.length}\nPuntuación promedio: ${avgScore.toFixed(2)}/4`);
    
    // Regresar a repasos
    window.location.href = 'repasos.html';
  }

  // Override logout function
  window.logout = function() {
    if (confirm('¿Cerrar sesión?')) {
      mockAPI.logout();
      window.location.href = '../auth/iniciar-sesion.html';
    }
  };
});
</script>
</body></html>
